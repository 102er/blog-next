## 为什么要限流？

简单来说：就是一定时间内限制请求的并发和请求量，保护自身系统和下游系统不被大量请求冲垮

以购物网站为例，例如一个秒杀活动，访问从平时的10万增加到了100万，系统的规划能力，最多可以支撑**50万访问**，那么就要执行限流规则，保证是一个可用的状态，不至于**服务器崩溃**，所有请求不可用。

## 限流的思想

> 在保证可用的情况下尽可能多增加进入的人数，其余的人在排队等待，或者返回友好提示，保证里面的进行系统的用户可以正常使用，防止系统雪崩。

## 限流的实现

限流算法很多，常见的有四大算法，分别是计数器算法、滑动窗口算法、 漏桶算法、令牌桶算法，下面逐一讲解。

限流的手段通常有计数器、漏桶、令牌桶。注意限流和限速（所有请求都会处理）的差别，视业务场景而定。

**（1）计数器：**

也叫做 固定窗口算法。

在一段时间间隔内（时间窗/时间区间），处理请求的最大数量固定，超过部分不做处理。

**（2）滑动窗口算法**

滑动窗口限流是对固定窗口限流算法的一种改进。

在固定窗口限流中，时间窗口是固定划分的，而滑动窗口限流将时间窗口划分为多个更小的子窗口，随着时间的推移，窗口会不断地滑动。

在统计请求数量时，会统计当前滑动窗口内所有子窗口的请求总和，当请求数量超过预设的阈值时，就拒绝后续的请求。

**（3）漏桶：**

漏桶大小固定，处理速度固定，但请求进入速度不固定（在突发情况请求过多时，会丢弃过多的请求）。

**（4）令牌桶：**

令牌桶的大小固定，令牌的产生速度固定，但是消耗令牌（即请求）速度不固定（可以应对一些某些时间请求过多的情况）；

每个请求都会从令牌桶中取出令牌，如果没有令牌则丢弃该次请求。

