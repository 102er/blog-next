---
title: TCP介绍
date: 2021-08-19 14:26:02
categories: 网络
tags:
    - TCP
---

## 简介

TCP 是一种面向连接的、可靠的、基于字节流的传输层通信协议，位于网络分层模型的传输层：

![osi](https://102er.github.io/images/osi-model.png)

- 面向连接：两个端必须建立tcp连接，才能通讯交换数据。
- 基于字节流：tcp连接双方的数据交换是以字节构成的有序但无结构的字节流。
- 可靠性：通过连接管理，流量控制，拥塞控制，超时重传机制，序号和确认序号等机制保证传输可靠。

### TCP报文段

![osi](https://102er.github.io/images/tcp-bw.png)

- 端口号：每个tcp报文包含源和目的端口号，2字节的端口号，端口号+ip可以组成一个socket
- 序号（seq）：数据序号，表示这个数据流在整个数据流中的序号，接收端可以根据序号组装数据
- 确认序号（ack）：确认序号，接收方成功接收数据，会回复发送端，并把接收的序号+1，告诉发送端自己接收了哪个序号的数据，下次数据要从ack序号开始发
- 首部长度：记录tcp头的长度，tcp
- 保留位：暂时没用
- 标志位：标记请求的目的，状态等
  - URG：值为 1 时，紧急指针生效，表示本次报文需要尽快传输，不要按照原本的队列次序传输
  - ACK：值为 1 时，确认序号生效，表示数据已经被接收
  - PSH：接收方应尽快将这个报文段交给应用层
  - RST：发送端遇到问题，想要释放当前连接，重建传输连接。
  - SYN：同步序号，用于发起一个连接
  - FIN：发送端要求关闭连接
- 窗口：TCP的流量控制由连接的每一端通过声明的窗口大小来提供。窗口大小为字节数，起始于确认序号字段指明的值，这个值是接收端正期望接收的字节。
- 检验和 (Checksum)：强制性必须携带的字段。检验和覆盖了整个 TCP 报文段，包括 TCP 首部和 TCP 数据，发送端根据特定算法对整个报文段计算出一个检验和，接收端会进行计算并验证。
- 紧急指针 (Urgent Pointer)：当 URG 控制位值为 1 时，此字段生效，紧急指针是一个正的偏移量，和序号字段中的值相加表示紧急数据最后一个字节的序号。 TCP 的紧急方式是发送端向另一端发送紧急数据的一种方式。
- 选项 (Options)：这一部分是可选字段，也就是非必须字段，最常见的可选字段是“最长报文大小 (MSS，Maximum Segment Size)”。
- 有效数据部分 (Data)：这部分也不是必须的，比如在建立和关闭 TCP 连接的阶段，双方交换的报文段就只包含 TCP 首部。

### 三次握手

### **四次挥手**
